<!doctype html>
<html lang="zh-Hant">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PLKP88TEVL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PLKP88TEVL');
</script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <link rel="icon" href="/icons/favicon.svg" type="image/svg+xml">
  <link rel="icon" href="/icons/web-app-manifest-192x192.png" sizes="192x192" type="image/png">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#0b1020">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9198582877062732"
     crossorigin="anonymous"></script>
<!-- iOS 專屬（Safari A2HS）-->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="旅行地圖時光機">


  <title>旅行地圖時光機</title>
  <style>
    :root{
      --bg:#0b1020; --card:#0f152b; --line:#223; --fg:#e9eefc; --muted:#9fb0d1; --accent:#3b82f6;
      --overlay: rgba(0,0,0,.5);
    }
    html,body{ height:100%; margin:0; background:var(--bg); color:var(--fg);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",sans-serif; }
    .wrap{ display:flex; flex-direction:column; min-height:100svh; }

    /* ===== Header & Nav ===== */
    header{ position:sticky; top:0; z-index:20; backdrop-filter:saturate(1.4) blur(8px);
      background:rgba(11,16,32,.75); border-bottom:1px solid var(--line); }
    nav{max-width:1100px;margin:0 auto;display:flex;align-items:center;justify-content:flex-start;padding:0 16px;}
    .logo{font-weight:700;font-size:18px;letter-spacing:.5px;padding:14px 0;margin-left:10px;}


    /* Desktop menu */
    .menu{ display:flex; gap:2px; }
    .menu button{ all:unset; cursor:pointer; padding:14px 20px; font-weight:600; font-size:15px; color:var(--muted);
      transition:.25s; border-bottom:2px solid transparent; }
    .menu button[aria-pressed="true"]{ color:var(--accent); border-color:var(--accent); }
    .menu button:hover{ color:var(--fg); }

    /* Mobile hamburger (hidden on desktop) */
    .hamburger{
      display:none; align-items:center; justify-content:center;
      width:40px; height:40px; margin-left:-8px; border-radius:8px; border:1px solid transparent;
      background:transparent; cursor:pointer;
    }
    .hamburger svg{ width:22px; height:22px;stroke:#fff;stroke-width:1; }
    .hamburger[aria-expanded="true"]{ background:rgba(255,255,255,.06); border-color:var(--line); }

    /* Drawer + Backdrop */
    .backdrop{
      position:fixed; inset:0; background:var(--overlay); opacity:0; pointer-events:none; transition:opacity .2s ease;
      z-index:18;
    }
    .drawer{
      position:fixed; inset:0 auto 0 0; width:min(80vw, 320px); max-width:90vw; background:var(--card);
      border-right:1px solid var(--line); transform:translateX(-100%); transition:transform .25s ease;
      z-index:19; display:flex; flex-direction:column;
    }
    .drawer-head{ display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--line); }
    .drawer-title{ font-weight:700; }
    .drawer-close{ all:unset; cursor:pointer; padding:8px; border-radius:8px; }
    .drawer-close:focus{ outline:2px solid var(--accent); outline-offset:2px; }
    .drawer-body{ padding:6px; }
    .drawer-body .drawer-btn{
      width:100%; text-align:left; display:block; border:1px solid var(--line); background:transparent;
      color:var(--fg); padding:14px 12px; margin:6px 6px; border-radius:10px; font-weight:600; cursor:pointer;font-size:18px;
    }
    .drawer-body .drawer-btn[aria-pressed="true"]{ border-color:var(--accent); color:var(--accent); }
    .drawer-body .drawer-btn:hover{ background:rgba(255,255,255,.04); }

    /* Open states (toggled by .open-drawer on body) */
    .open-drawer .backdrop{ opacity:1; pointer-events:auto; }
    .open-drawer .drawer{ transform:none; }

    /* Layout main/iframe/footer */
    main{ flex:1; display:flex; }
    .frame-wrap{ position:relative; flex:1; min-height:0; }
    
    iframe{position:absolute; inset:0; width:100%; height:100%;border:0;background:#fff;}

    .hidden{ display:none !important; }

    /* ===== Responsive ===== */
    @media (max-width: 900px){
      .menu{ display:none; }                /* hide desktop tabs on mobile */
      .hamburger{ display:flex; }           /* show hamburger */
      .logo{ padding:10px 0;font-size:20px; }              /* a bit tighter on mobile */
    }

    @media (prefers-reduced-motion: reduce){
      .backdrop, .drawer{ transition:none; }
    }
    .tab:focus,
.drawer-btn:focus,
.hamburger:focus,
.drawer-close:focus {
  outline: none;
  box-shadow: none;
}
  /* Desktop：把選單整排往右靠 */
@media (min-width: 901px){
  .menu{ margin-left: auto; }  /* 讓 .logo 在左、.menu 貼右 */
}
/* CTA 小膠囊：預設隱藏，播放時加 .on 顯示 */
.promo-rotator{
  display:none; align-items:center; gap:.5rem;
  margin-left:12px; margin-right:auto; /* 讓它卡在 logo 和 menu 中間 */
  padding:.28rem .64rem; border:1px solid var(--line, #e5e7eb);
  border-radius:999px; background:var(--card, #fff);
  color:var(--fg, #111); text-decoration:none;
  font-size:14px; line-height:1; white-space:nowrap;
  max-width:420px; overflow:hidden;
}
.promo-rotator.on{ display:flex; }

/* 文字進出場動畫（輕微） */
.promo-rotator .pr-msg{ display:inline-block; animation:pr-fade 2.1s ease-in-out both; }
@keyframes pr-fade{
  0%{opacity:0; transform:translateY(6px);}
  10%{opacity:1; transform:translateY(0);}
  90%{opacity:1;}
  100%{opacity:0; transform:translateY(-6px);}
}

/* 手機：更小、更貼近標題；選單多半隱藏不影響 */
@media (max-width: 900px){
  .promo-rotator{ font-size:13px; max-width:60vw; }
}
@media (max-width: 480px){
  .promo-rotator{ font-size:12.5px; padding:.22rem .52rem; }
}

/* 減少動態偏好：關閉動畫但仍顯示一次 */
@media (prefers-reduced-motion: reduce){
  .promo-rotator .pr-msg{ animation:none !important; }
}
/* 讓 CTA 文字只淡入並維持顯示（覆蓋舊的 pr-fade） */
.promo-rotator .pr-msg{
  animation: none !important;  /* 取消舊的 2.1s 淡出動畫 */
  opacity: 1;
  transform: none;
}
.promo-rotator.on .pr-msg{
  animation: pr-fade-in .3s ease-out both !important; /* 只做淡入 */
}

@keyframes pr-fade-in{
  from{ opacity:0; transform: translateY(6px); }
  to  { opacity:1; transform: translateY(0); }
}
/* 讓整排永遠同一行 */
nav{ flex-wrap: nowrap; }

/* 標題不換行、可縮、超出省略號 */
.logo{
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  flex: 1 1 auto;   /* 吃可用空間 */
  min-width: 0;     /* 允許在 flex 內縮小，省略號才會生效 */
}

/* 訂閱膠囊可縮，不把標題擠換行 */
.promo-rotator{
  flex: 0 1 auto;
  min-width: 0;
  text-overflow: ellipsis;
}

/* 防 iOS Safari 自動放大導致換行 */
html{ -webkit-text-size-adjust: 100%; }

/* 超小螢幕再把標題字稍收一點（覆寫你原本 20px） */
@media (max-width: 480px){
  .logo{ font-size: 18px; }
}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <nav>
        <button class="hamburger" id="btn-hamburger" aria-label="開啟選單" aria-expanded="false" aria-controls="drawer">
          <!-- 3-line icon -->
          <svg aria-hidden="true" viewBox="0 0 24 24" fill="currentColor">
            <path d="M4 6h16v2H4zM4 11h16v2H4zM4 16h16v2H4z"/>
          </svg>
        </button>
        <div class="logo">旅行地圖時光機</div>

        <!-- CTA 輪播（logo 後、menu 前） -->
<a class="promo-rotator" id="promoRotator"
   href="https://www.youtube.com/channel/UCBO0jFbcjbi2f3mxnsEDxDg?sub_confirmation=1"
   target="_blank" rel="noopener">
  <span class="pr-icon">🔔</span>
  <span class="pr-msg" aria-live="polite"></span>
</a>

        <!-- Desktop tabs -->
        <div class="menu" role="tablist" aria-label="切換內嵌頁面">
          <button class="tab" id="tab-a" role="tab" aria-controls="panel-a" aria-pressed="true">Time Travel(時光旅行)</button>
          <button class="tab" id="tab-b" role="tab" aria-controls="panel-b" aria-pressed="false">Map Travel(地圖旅行)</button>
          <button class="tab" id="tab-c" role="tab" aria-controls="panel-c" aria-pressed="false">AI Diary 日記(Beta)</button>
          <button class="tab" id="tab-d" role="tab" aria-controls="panel-d" aria-pressed="false">YourJovi平台頻道</button>
        </div>
      </nav>
    </header>

    <!-- Backdrop + Drawer (mobile) -->
    <div class="backdrop" id="backdrop" hidden></div>
    <aside class="drawer" id="drawer" aria-label="主選單" aria-hidden="true">
      <div class="drawer-head">
        <div class="drawer-title">選單</div>
        <button class="drawer-close" id="btn-close" aria-label="關閉選單">
          <svg aria-hidden="true" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
            <path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.42L10.59 13.4 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.6 16.89 4.3z"/>
          </svg>
        </button>
      </div>
      <div class="drawer-body">
        <button class="drawer-btn" data-tab="a" aria-pressed="true">Time Travel(時光旅行)</button>
        <button class="drawer-btn" data-tab="b" aria-pressed="false">Map Travel(地圖旅行)</button>
        <button class="drawer-btn" data-tab="c" aria-pressed="false">AI Diary 日記(Beta)</button>
        <button class="drawer-btn" data-tab="d" aria-pressed="false">YourJovi平台頻道</button>
      </div>
    </aside>

    <main>
      <div class="frame-wrap">
        <iframe id="panel-a" title="頁面 A" loading="lazy" allow="fullscreen; picture-in-picture"></iframe>
        <iframe id="panel-b" title="頁面 B" class="hidden" loading="lazy" allow="fullscreen; picture-in-picture"></iframe>
        <iframe id="panel-c" title="頁面 C" class="hidden" loading="lazy" allow="fullscreen; picture-in-picture"></iframe>
        <iframe id="panel-d" title="頁面 D" class="hidden" loading="lazy" allow="fullscreen; picture-in-picture"></iframe>
      </div>
    </main>
  </div>

  <script>
    /* ===== Your pages mapping ===== */
    const bas_url = "https://script.google.com/macros/s/AKfycbznnuzv1qB6Sk6hSu6aM8etG0KAYZyUKxRZzXjHRPwryNpRHryHyyOhOxKvMzxc8bCn/exec";
    const PAGES = {
      a: bas_url,
      b: bas_url + "?view=map",
      c: bas_url + "?view=diary",      
      d: bas_url + "?view=help"
    };

    /* ===== Tab elements ===== */
    const tabs = {
      a: document.getElementById('tab-a'),
      b: document.getElementById('tab-b'),
      c: document.getElementById('tab-c'),
      d: document.getElementById('tab-d')
    };
    const frames = {
      a: document.getElementById('panel-a'),
      b: document.getElementById('panel-b'),
      c: document.getElementById('panel-c'),
      d: document.getElementById('panel-d')
    };

    /* ===== Drawer elements (mobile) ===== */
    const body = document.body;
    const backdrop = document.getElementById('backdrop');
    const drawer = document.getElementById('drawer');
    const btnHamburger = document.getElementById('btn-hamburger');
    const btnClose = document.getElementById('btn-close');
    const drawerBtns = Array.from(document.querySelectorAll('.drawer-btn'));

    function ensureSrc(which){
  if (PAGES[which] && !frames[which].src) {
    const url = new URL(location.href);
    // 保留除了 view 以外的所有參數
    url.searchParams.delete('view');
    const extra = url.searchParams.toString();
    frames[which].src = PAGES[which] + (extra ? '&' + extra : '');
  }
}


    function show(which){
      for(const k of Object.keys(tabs)){
        tabs[k]?.setAttribute('aria-pressed', k===which);
        const pressed = (k===which);
        const dbtn = drawerBtns.find(b=>b.dataset.tab===k);
        if (dbtn) dbtn.setAttribute('aria-pressed', pressed);
        frames[k].classList.toggle('hidden', !pressed);
      }
      ensureSrc(which);
      history.replaceState(null, '', location.pathname);
      localStorage.setItem('multiSwitcher:view', which);
    }

    /* ===== Drawer open/close helpers ===== */
    function openDrawer(){
      body.classList.add('open-drawer');
      drawer.setAttribute('aria-hidden', 'false');
      btnHamburger.setAttribute('aria-expanded', 'true');
      backdrop.hidden = false;
      // focus first button for accessibility
      setTimeout(()=> drawerBtns[0]?.focus(), 0);
    }
    function closeDrawer(){
      body.classList.remove('open-drawer');
      drawer.setAttribute('aria-hidden', 'true');
      btnHamburger.setAttribute('aria-expanded', 'false');
      backdrop.hidden = true;
      btnHamburger.focus();
    }

    // Toggle via hamburger / close button / backdrop
    btnHamburger.addEventListener('click', () => {
      const expanded = btnHamburger.getAttribute('aria-expanded') === 'true';
      expanded ? closeDrawer() : openDrawer();
    });
    btnClose.addEventListener('click', closeDrawer);
    backdrop.addEventListener('click', closeDrawer);

    // ESC to close
    window.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape' && body.classList.contains('open-drawer')) closeDrawer();
    });

    // Clicking drawer items: switch tab + close drawer
    drawerBtns.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const which = btn.dataset.tab;
        show(which);
        closeDrawer();
      });
    });

    // Desktop tab clicks
    for(const k of Object.keys(tabs)){
      tabs[k].addEventListener('click', ()=> show(k));
    }

    // Init year and initial tab
const url = new URL(location.href);
const qView = (url.searchParams.get('view')||'').toLowerCase();
const mapDay = url.searchParams.get('map_day');
const mapAction = url.searchParams.get('map_action');

const saved = localStorage.getItem('multiSwitcher:view');
let initial = (['a','b','c','d'].includes(qView)) ? qView
            : (['a','b','c','d'].includes(saved) ? saved : 'a');

// 若帶了 map_day 要直接打開地圖頁
if (mapDay && mapAction === 'play') initial = 'b';

show(initial);


if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    const scope = '/'; // 若 repo 子路徑，改成 '/my-repo/'
    navigator.serviceWorker.register('/sw.js', { scope }).catch(console.error);
  });
}

(function(){
  const el   = document.getElementById('promoRotator');
  if(!el) return;
  const span = el.querySelector('.pr-msg');

  // 要輪播的訊息（可增減）
  const MSGS = [
  '先訂先贏',
  '新影片通知',
  '訂閱解鎖',
  '首播不缺席',
  '搶先看旅程',
  '跟上每日 Vlog',
  '1分鐘看世界',
  'AI日記已上線',
  '代表照出爐',
  '地圖新地標',
  '時間軸連播',
  '旅遊攻略更新',
  '航線圖更新',
  '追蹤我們',
  '按讚＋分享',
  '下一站去哪？'
];



  // ===== 可調參數 =====
  const FIRST_SHOW_DELAY_MS = 2000;         // 進站多久後第一次顯示
  const DWELL_MS            = 60_000;       // 每次顯示停留時間（約 1 分鐘）
  const GAP_MIN_MS          = 5*60_000;     // 下一次顯示的最短間隔（5 分鐘）
  const GAP_MAX_MS          = 15*60_000;    // 下一次顯示的最長間隔（15 分鐘）
  // =====================

  let lastIdx = -1;
  let tShow = 0, tHide = 0;

  function randBetween(min, max){
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }
  function pickNextIndex(){
    if (MSGS.length === 1) return 0;
    let idx;
    do { idx = Math.floor(Math.random() * MSGS.length); } while (idx === lastIdx);
    lastIdx = idx;
    return idx;
  }
  function setMsg(text){
    // 重新觸發 CSS 的淡入/淡出動畫
    span.textContent = text;
    span.style.animation = 'none'; void span.offsetWidth; span.style.animation = null;
  }

  function showOnce(){
    clearTimeout(tShow); clearTimeout(tHide);
    setMsg(MSGS[pickNextIndex()]);
    el.classList.add('on');
    tHide = setTimeout(hide, DWELL_MS);
  }
  function hide(){
    el.classList.remove('on');
    scheduleNext();
  }
  function scheduleNext(){
    const gap = randBetween(GAP_MIN_MS, GAP_MAX_MS);
    tShow = setTimeout(() => {
      // 若使用者切到背景頁，再緩一緩（避免他不在時彈出）
      if (document.hidden) return scheduleNext();
      showOnce();
    }, gap);
  }

  // 首次顯示
  setTimeout(() => {
    if (!document.hidden) showOnce();
    else scheduleNext();
  }, FIRST_SHOW_DELAY_MS);

  // 使用者返回此分頁時，如正好沒有顯示也沒有排程，就排一個短延遲
  document.addEventListener('visibilitychange', () => {
    if (!document.hidden && !el.classList.contains('on') && !tShow){
      tShow = setTimeout(showOnce, 5000);
    }
  });
})();

    // 在定義 frames 後面加上這段（frames.b 已存在）
frames.b.addEventListener('load', () => {
  // 若網址帶了 map_day=YYYY-MM-DD&map_action=play，就通知子頁播放
  if (mapDay && mapAction === 'play') {
    try {
      frames.b.contentWindow.postMessage({ type:'playDay', day: mapDay }, 'https://www.yourjovi.com'); 
      // 若地圖頁是跑在 GAS 網域，這裡可改成 '*'
    } catch(_) {}
  }
});

</script>
</body>
</html>
