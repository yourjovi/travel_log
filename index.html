<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <link rel="icon" href="/icons/favicon.svg" type="image/svg+xml">
  <link rel="icon" href="/icons/web-app-manifest-192x192.png" sizes="192x192" type="image/png">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#0b1020">

<!-- iOS 專屬（Safari A2HS）-->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="旅行地圖時光機">


  <title>旅行地圖時光機</title>
  <style>
    :root{
      --bg:#0b1020; --card:#0f152b; --line:#223; --fg:#e9eefc; --muted:#9fb0d1; --accent:#3b82f6;
      --overlay: rgba(0,0,0,.5);
    }
    html,body{ height:100%; margin:0; background:var(--bg); color:var(--fg);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",sans-serif; }
    .wrap{ display:flex; flex-direction:column; min-height:100svh; }

    /* ===== Header & Nav ===== */
    header{ position:sticky; top:0; z-index:20; backdrop-filter:saturate(1.4) blur(8px);
      background:rgba(11,16,32,.75); border-bottom:1px solid var(--line); }
    nav{max-width:1100px;margin:0 auto;display:flex;align-items:center;justify-content:flex-start;padding:0 16px;}
    .logo{font-weight:700;font-size:18px;letter-spacing:.5px;padding:14px 0;margin-left:10px;}


    /* Desktop menu */
    .menu{ display:flex; gap:2px; }
    .menu button{ all:unset; cursor:pointer; padding:14px 20px; font-weight:600; font-size:15px; color:var(--muted);
      transition:.25s; border-bottom:2px solid transparent; }
    .menu button[aria-pressed="true"]{ color:var(--accent); border-color:var(--accent); }
    .menu button:hover{ color:var(--fg); }

    /* Mobile hamburger (hidden on desktop) */
    .hamburger{
      display:none; align-items:center; justify-content:center;
      width:40px; height:40px; margin-left:-8px; border-radius:8px; border:1px solid transparent;
      background:transparent; cursor:pointer;
    }
    .hamburger svg{ width:22px; height:22px;stroke:#fff;stroke-width:1; }
    .hamburger[aria-expanded="true"]{ background:rgba(255,255,255,.06); border-color:var(--line); }

    /* Drawer + Backdrop */
    .backdrop{
      position:fixed; inset:0; background:var(--overlay); opacity:0; pointer-events:none; transition:opacity .2s ease;
      z-index:18;
    }
    .drawer{
      position:fixed; inset:0 auto 0 0; width:min(80vw, 320px); max-width:90vw; background:var(--card);
      border-right:1px solid var(--line); transform:translateX(-100%); transition:transform .25s ease;
      z-index:19; display:flex; flex-direction:column;
    }
    .drawer-head{ display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--line); }
    .drawer-title{ font-weight:700; }
    .drawer-close{ all:unset; cursor:pointer; padding:8px; border-radius:8px; }
    .drawer-close:focus{ outline:2px solid var(--accent); outline-offset:2px; }
    .drawer-body{ padding:6px; }
    .drawer-body .drawer-btn{
      width:100%; text-align:left; display:block; border:1px solid var(--line); background:transparent;
      color:var(--fg); padding:14px 12px; margin:6px 6px; border-radius:10px; font-weight:600; cursor:pointer;font-size:18px;
    }
    .drawer-body .drawer-btn[aria-pressed="true"]{ border-color:var(--accent); color:var(--accent); }
    .drawer-body .drawer-btn:hover{ background:rgba(255,255,255,.04); }

    /* Open states (toggled by .open-drawer on body) */
    .open-drawer .backdrop{ opacity:1; pointer-events:auto; }
    .open-drawer .drawer{ transform:none; }

    /* Layout main/iframe/footer */
    main{ flex:1; display:flex; }
    .frame-wrap{ position:relative; flex:1; min-height:0; }
    
    iframe{position:absolute; inset:0; width:100%; height:100%;border:0;background:transparent;}

    .hidden{ display:none !important; }

    /* ===== Responsive ===== */
    @media (max-width: 900px){
      .menu{ display:none; }                /* hide desktop tabs on mobile */
      .hamburger{ display:flex; }           /* show hamburger */
      .logo{ padding:10px 0;font-size:20px; }              /* a bit tighter on mobile */
    }

    @media (prefers-reduced-motion: reduce){
      .backdrop, .drawer{ transition:none; }
    }
    .tab:focus,
.drawer-btn:focus,
.hamburger:focus,
.drawer-close:focus {
  outline: none;
  box-shadow: none;
}
  
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <nav>
        <button class="hamburger" id="btn-hamburger" aria-label="開啟選單" aria-expanded="false" aria-controls="drawer">
          <!-- 3-line icon -->
          <svg aria-hidden="true" viewBox="0 0 24 24" fill="currentColor">
            <path d="M4 6h16v2H4zM4 11h16v2H4zM4 16h16v2H4z"/>
          </svg>
        </button>
        <div class="logo">旅行地圖時光機</div>

        <!-- Desktop tabs -->
        <div class="menu" role="tablist" aria-label="切換內嵌頁面">
          <button class="tab" id="tab-a" role="tab" aria-controls="panel-a" aria-pressed="true">時光旅行</button>
          <button class="tab" id="tab-b" role="tab" aria-controls="panel-b" aria-pressed="false">地圖旅行</button>
          <button class="tab" id="tab-c" role="tab" aria-controls="panel-c" aria-pressed="false">AI日記(Beta)</button>
          <button class="tab" id="tab-d" role="tab" aria-controls="panel-d" aria-pressed="false">我們頻道</button>
        </div>
      </nav>
    </header>

    <!-- Backdrop + Drawer (mobile) -->
    <div class="backdrop" id="backdrop" hidden></div>
    <aside class="drawer" id="drawer" aria-label="主選單" aria-hidden="true">
      <div class="drawer-head">
        <div class="drawer-title">選單</div>
        <button class="drawer-close" id="btn-close" aria-label="關閉選單">
          <svg aria-hidden="true" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
            <path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.42L10.59 13.4 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.29 10.59 10.6 16.89 4.3z"/>
          </svg>
        </button>
      </div>
      <div class="drawer-body">
        <button class="drawer-btn" data-tab="a" aria-pressed="true">時光旅行</button>
        <button class="drawer-btn" data-tab="b" aria-pressed="false">地圖旅行</button>
        <button class="drawer-btn" data-tab="c" aria-pressed="false">AI日記(Beta)</button>
        <button class="drawer-btn" data-tab="d" aria-pressed="false">我們頻道</button>
      </div>
    </aside>

    <main>
      <div class="frame-wrap">
        <iframe id="panel-a" title="頁面 A" loading="lazy" allow="fullscreen; picture-in-picture"></iframe>
        <iframe id="panel-b" title="頁面 B" class="hidden" loading="lazy" allow="fullscreen; picture-in-picture"></iframe>
        <iframe id="panel-c" title="頁面 C" class="hidden" loading="lazy" allow="fullscreen; picture-in-picture"></iframe>
        <iframe id="panel-d" title="頁面 D" class="hidden" loading="lazy" allow="fullscreen; picture-in-picture"></iframe>
      </div>
    </main>
  </div>

  <script>
    /* ===== Your pages mapping ===== */
    const PAGES = {
      a: "https://script.google.com/macros/s/AKfycbzr6ddtKdXaAD0BW9JbBpoVg5oXESKna3TA8STHpGblsZ_s6PM93bggdP_oB5KhAvfh/exec",
      b: "https://script.google.com/macros/s/AKfycbzr6ddtKdXaAD0BW9JbBpoVg5oXESKna3TA8STHpGblsZ_s6PM93bggdP_oB5KhAvfh/exec?view=map",
      c: "https://script.google.com/macros/s/AKfycbzm7jm-GNepzjws32JQ9T_ndtrGqqlKF3900n_1kRBhFz1cwqIP3R1ORMXOQcD-FmIw/exec",
      d: "https://script.google.com/macros/s/AKfycbzm7jm-GNepzjws32JQ9T_ndtrGqqlKF3900n_1kRBhFz1cwqIP3R1ORMXOQcD-FmIw/exec?site=d"
    };

    /* ===== Tab elements ===== */
    const tabs = {
      a: document.getElementById('tab-a'),
      b: document.getElementById('tab-b'),
      c: document.getElementById('tab-c'),
      d: document.getElementById('tab-d')
    };
    const frames = {
      a: document.getElementById('panel-a'),
      b: document.getElementById('panel-b'),
      c: document.getElementById('panel-c'),
      d: document.getElementById('panel-d')
    };

    /* ===== Drawer elements (mobile) ===== */
    const body = document.body;
    const backdrop = document.getElementById('backdrop');
    const drawer = document.getElementById('drawer');
    const btnHamburger = document.getElementById('btn-hamburger');
    const btnClose = document.getElementById('btn-close');
    const drawerBtns = Array.from(document.querySelectorAll('.drawer-btn'));

    function ensureSrc(which){
      if(PAGES[which] && !frames[which].src){
        frames[which].src = PAGES[which];
      }
    }

    function show(which){
      for(const k of Object.keys(tabs)){
        tabs[k]?.setAttribute('aria-pressed', k===which);
        const pressed = (k===which);
        const dbtn = drawerBtns.find(b=>b.dataset.tab===k);
        if (dbtn) dbtn.setAttribute('aria-pressed', pressed);
        frames[k].classList.toggle('hidden', !pressed);
      }
      ensureSrc(which);
      history.replaceState(null, '', location.pathname);
      localStorage.setItem('multiSwitcher:view', which);
    }

    /* ===== Drawer open/close helpers ===== */
    function openDrawer(){
      body.classList.add('open-drawer');
      drawer.setAttribute('aria-hidden', 'false');
      btnHamburger.setAttribute('aria-expanded', 'true');
      backdrop.hidden = false;
      // focus first button for accessibility
      setTimeout(()=> drawerBtns[0]?.focus(), 0);
    }
    function closeDrawer(){
      body.classList.remove('open-drawer');
      drawer.setAttribute('aria-hidden', 'true');
      btnHamburger.setAttribute('aria-expanded', 'false');
      backdrop.hidden = true;
      btnHamburger.focus();
    }

    // Toggle via hamburger / close button / backdrop
    btnHamburger.addEventListener('click', () => {
      const expanded = btnHamburger.getAttribute('aria-expanded') === 'true';
      expanded ? closeDrawer() : openDrawer();
    });
    btnClose.addEventListener('click', closeDrawer);
    backdrop.addEventListener('click', closeDrawer);

    // ESC to close
    window.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape' && body.classList.contains('open-drawer')) closeDrawer();
    });

    // Clicking drawer items: switch tab + close drawer
    drawerBtns.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const which = btn.dataset.tab;
        show(which);
        closeDrawer();
      });
    });

    // Desktop tab clicks
    for(const k of Object.keys(tabs)){
      tabs[k].addEventListener('click', ()=> show(k));
    }

    // Init year and initial tab
    const url = new URL(location.href);
    const qView = (url.searchParams.get('view')||'').toLowerCase();
    const saved = localStorage.getItem('multiSwitcher:view');
    const initial = (['a','b','c','d'].includes(qView)) ? qView : (['a','b','c','d'].includes(saved) ? saved : 'a');
    show(initial);

if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    const scope = '/'; // 若 repo 子路徑，改成 '/my-repo/'
    navigator.serviceWorker.register('/sw.js', { scope }).catch(console.error);
  });
}
    
  </script>
</body>
</html>
